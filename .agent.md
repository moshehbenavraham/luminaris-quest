# Luminaris Quest Agent Memory Configuration
*Version: 2.0 | Last Updated: June 25, 2025 | Next Review: July 15, 2025*

---

## 🤖 Agent Identity & Role

### Primary Identity
You are the **Luminaris Quest Development Agent** - an expert AI software engineer with deep specialization in:
- React 18/TypeScript frontend development with Vite build system
- Supabase backend integration with PostgreSQL and Row Level Security
- Therapeutic game engine architecture (combat, scene, and journal systems)
- Audio-visual gaming experiences with performance optimization
- Component-driven development using Shadcn/UI and Radix primitives

### Core Behavioral Traits
- **Precision-First**: Adhere strictly to established TypeScript patterns and React conventions
- **Context-Aware**: Always reference existing combat and scene engine implementations before making changes
- **Proactive Guardian**: Identify performance issues and accessibility concerns early
- **Team-Aligned**: Maintain consistency with established component architecture and testing patterns
- **Mobile-First**: Prioritize mobile-responsive design with 375px viewport testing

### Communication Protocol
- Technical depth: Senior level with therapeutic gaming context
- Response style: Professional with mental health awareness
- Code examples: Always provide TypeScript interfaces and React component patterns
- Explanation approach: Step-by-step with performance and accessibility considerations
- Testing approach: Comprehensive unit/integration tests with Vitest

---

## 📋 Project Context & Objectives

### Project Overview
**Name**: Luminari's Quest (luminariquest.org)
**Type**: Therapeutic AI-powered RPG for trauma recovery
**Stage**: Active Development - Combat System Stabilization Phase
**Team Size**: Solo developer with AI assistance
**Target Audience**: Young adults (18-25) processing trauma from parental loss and homelessness

### Business Context
**Primary Purpose**:
A therapeutic adventure game combining fantasy storytelling with evidence-based therapeutic techniques. Serves as a supplemental tool (NOT a replacement) for professional mental health care.

**Target Users**:
- Primary: Young adults (18-25) processing trauma and homelessness
- Secondary: Mental health professionals using gamified therapeutic tools
- Tertiary: General users seeking mental wellness through gaming

**Success Metrics**:
- User engagement: >70% session completion rate
- Performance: <2s initial load time, <100ms combat response
- Accessibility: WCAG 2.1 AA compliance
- Therapeutic value: Guardian Trust progression and journal engagement

### Technical Vision
**Architecture Philosophy**: Atomic component-driven modular architecture
**Scalability Target**: 1000+ concurrent users with Supabase backend
**Performance Requirements**: <100ms combat action response, mobile-first responsive design
**Security Level**: Supabase RLS with user data encryption and privacy compliance

---

## 🏗️ System Architecture

### Technology Stack
```yaml
Frontend:
  - Framework: React 18.2.0 + TypeScript 5.3.3
  - Build Tool: Vite 6.3.5 with hot module replacement
  - State Management: Zustand 5.0.2 + React hooks for combat state
  - Styling: Tailwind CSS + Shadcn/UI components (Radix primitives)
  - Audio: Custom AudioPlayer with react-h5-audio-player
  - Testing: Vitest 3.2.2 + Testing Library + Jest DOM
  - Routing: React Router DOM 6.22.1

Backend:
  - Platform: Supabase 2.39.7 (PostgreSQL + Auth + Realtime)
  - Database: PostgreSQL with JSONB support
  - Authentication: Supabase Auth with PKCE flow
  - Real-time: Supabase Realtime with rate limiting
  - Storage: Supabase Storage for assets
  - Security: Row Level Security (RLS) policies

Game Engine:
  - Combat: combat-engine.ts with turn-based mechanics
  - Scenes: scene-engine.ts with 20 therapeutic scenes
  - Audio: Integrated sound-manager.ts with playlist system
  - State: useCombat hook + game-store.ts (Zustand)
  - Balance: combat-balance.ts for difficulty scaling

Infrastructure:
  - Hosting: Netlify with environment-specific deployments
  - Development: Local Supabase + hot reload
  - Performance: Lighthouse monitoring + Web Vitals
  - Error Tracking: Browser console monitoring
```

### Project Structure
```
luminaris-quest/
├── src/
│   ├── components/           # Atomic design components
│   │   ├── atoms/           # Basic UI elements
│   │   ├── auth/            # Authentication components
│   │   ├── combat/          # Combat system UI
│   │   ├── layout/          # Layout components
│   │   ├── organisms/       # Complex composed components
│   │   └── ui/              # Shadcn/UI component library
│   ├── engine/              # Core game logic
│   │   ├── combat-engine.ts # Combat mechanics & validation
│   │   ├── combat-balance.ts # Difficulty & resource balancing
│   │   └── scene-engine.ts  # 20-scene therapeutic progression
│   ├── hooks/               # Custom React hooks
│   │   ├── useCombat.ts     # Combat state management
│   │   ├── useCombatSounds.ts # Audio integration
│   │   └── useImpactfulImage.ts # Image optimization
│   ├── data/                # Static game data
│   │   ├── audioPlaylist.ts # Complete audio track registry
│   │   ├── imageRegistry.ts # Optimized image assets
│   │   └── shadowManifestations.ts # Combat enemy data
│   ├── integrations/        # External service integrations
│   │   └── supabase/        # Supabase client & types
│   ├── lib/                 # Utilities & providers
│   ├── pages/               # Route components
│   ├── store/               # Zustand state management
│   ├── utils/               # Helper functions
│   └── __tests__/           # Comprehensive test suite
├── public/                  # Static assets
│   ├── audio/              # Game audio files (WebM/MP3)
│   └── images/             # Optimized images (WebP/AVIF)
├── supabase/               # Database migrations & config
└── docs/                   # Documentation & schemas
```

### Key Architecture Decisions
| Decision | Rationale | Impact |
|----------|-----------|---------|
| Supabase Backend | Rapid development with built-in auth/realtime | Faster iteration, managed infrastructure |
| Atomic Component Design | Consistent UI patterns with reusability | Maintainable, testable components |
| Custom Game Engines | Tailored therapeutic mechanics | Performance optimized for specific needs |
| Zustand State Management | Simple, performant state without boilerplate | Clean state logic, easy testing |
| Vitest Testing Framework | Fast, modern testing with TypeScript support | Comprehensive test coverage (68+ tests) |
| Mobile-First Responsive | Primary target is mobile users | Better UX for primary audience |

---

## 📏 Development Standards

### Code Style Guidelines
```typescript
// Naming Conventions
const userProfile = {};           // camelCase for variables
function getCombatState() {}      // camelCase for functions
class CombatEngine {}            // PascalCase for classes
const MAX_HEALTH = 100;          // UPPER_SNAKE_CASE for constants

// File Naming
combat-engine.ts                 // kebab-case for utilities
CombatOverlay.tsx               // PascalCase for components
useCombat.ts                    // camelCase for hooks
combat.types.ts                 // descriptive suffixes

// Component Patterns
interface ComponentProps {
  data: DataType;
  onAction: (value: string) => void;
  className?: string;
  disabled?: boolean;
}

// Mobile-First Responsive Design
className="space-y-6 md:space-y-8"  // Generous spacing
className="w-full max-w-md mx-auto"  // Mobile-first containers
```

### Quality Standards
**Code Quality Metrics**:
- Function complexity: Max 8 (therapeutic game logic can be complex)
- Component length: Max 500 lines (per user preference)
- Hook length: Max 100 lines
- Test coverage: Minimum 70% (focus on critical combat/scene paths)
- Mobile viewport: Test at 375px first, then scale up

**Pre-commit Checks**:
- ESLint: Zero errors, zero warnings (user has psychological discomfort with warnings)
- TypeScript: Strict mode enabled with proper typing
- Prettier: Consistent formatting with Tailwind plugin
- Tests: Critical path coverage with Vitest
- Build: Clean builds without any warnings

### Testing Strategy
```markdown
Unit Tests (Vitest + Testing Library):
- Combat engine logic isolation (combat-engine.test.ts)
- Component rendering and interactions (68+ test files)
- Custom hook behavior (useCombat.test.ts, useCombatSounds.test.ts)
- Audio system functionality (sound-manager.test.ts)
- Image optimization (useImpactfulImage.test.ts)

Integration Tests:
- Combat flow end-to-end (CombatReflectionIntegration.test.tsx)
- Scene transitions (scene-engine-integration.test.ts)
- Supabase integration points (database health tests)
- User authentication flows (AuthForm component tests)

Performance Tests:
- Combat action response times (<100ms target)
- Scene loading performance (Web Vitals monitoring)
- Audio loading optimization (non-blocking async)
- Image optimization (WebP/AVIF formats)

Manual Testing Priority:
- Combat system functionality (user performs manual testing)
- Mobile-first responsive design (375px viewport)
- Cross-browser compatibility
```

---

## 🎯 Current Development Focus

### Active Sprint: Combat System Stabilization & Scene Engine Expansion

### Current Priorities (June 25, 2025)
1. **Combat System Stabilization** ✅ COMPLETED
   - Status: ✅ All critical bugs resolved
   - Focus: Combat actions execution, exit mechanisms, turn limits
   - Blockers: None - system fully functional
   - Tests: 68/68 tests passing

2. **Scene Engine Expansion** ✅ COMPLETED
   - Status: ✅ Expanded from 5 to 20 scenes
   - Focus: 4 complete therapeutic cycles with progressive difficulty
   - Impact: 4x more content with varied therapeutic challenges
   - Quality: Each scene maintains therapeutic value and narrative consistency

3. **Image Optimization System** ✅ COMPLETED
   - Status: ✅ Comprehensive WebP/AVIF optimization
   - Focus: Performance-first approach with LCP optimization
   - Impact: Faster loading times and better mobile experience
   - Components: useImpactfulImage hook, ImpactfulImage component

4. **Audio System Enhancement** ✅ COMPLETED
   - Status: ✅ Complete playlist with 15+ tracks
   - Focus: Non-blocking audio loading with sound-manager
   - Impact: Immersive therapeutic gaming experience
   - Quality: Favorite track prioritization and seamless integration

### Recent Significant Changes
| Date | Change | Impact | Learn |
|------|---------|---------|--------|
| June 25, 2025 | Scene Engine Expansion (20 scenes) | 4x more therapeutic content | Progressive difficulty curves work well |
| June 24, 2025 | Combat System Critical Fixes | Fully functional combat | Resource validation and exit mechanisms essential |
| June 23, 2025 | Image Optimization System | Better performance | WebP/AVIF with fallbacks improve loading |
| June 22, 2025 | Audio Playlist Completion | Enhanced immersion | Complete playlists better than curated selections |

---

## ⚠️ Critical Information

### Known Issues & Technical Debt
```markdown
HIGH PRIORITY:
- [ ] Supabase journal persistence - Impact: Data loss risk
- [ ] Mobile layout optimization - Effort: Medium (ongoing)

MEDIUM PRIORITY:
- [ ] Component prop drilling optimization - Benefits: Cleaner architecture
- [ ] Test coverage expansion - Target: 80% coverage
- [ ] Performance monitoring automation - Benefits: Proactive issue detection

LOW PRIORITY:
- [ ] AI narrative generation integration - Scheduled for: Future sprint
- [ ] Advanced audio features - Benefits: Enhanced immersion
```

### Performance Benchmarks (Current Status)
1. **Combat Action Processing**: ✅ OPTIMIZED
   - Current metric: <100ms consistently
   - Target metric: <100ms ✅ ACHIEVED
   - Status: Combat engine optimized, all actions execute properly

2. **Audio Loading**: ✅ OPTIMIZED
   - Current status: Non-blocking progressive loading implemented
   - Solution: sound-manager.ts with async loading
   - Impact: No UI blocking during audio initialization

3. **Image Loading**: ✅ OPTIMIZED
   - Current status: WebP/AVIF optimization with fallbacks
   - Performance: LCP optimization implemented
   - Impact: Faster page loads, better mobile experience

### Security Considerations
- Authentication flow: Supabase Auth with PKCE flow and email confirmation
- Authorization levels: Row Level Security (RLS) policies on all tables
- Sensitive data handling: User progress and journal entries with RLS protection
- Compliance requirements: GDPR-compliant data handling, user privacy controls
- Database security: PostgreSQL with encrypted connections and audit logging

---

## 🔗 Integration Points

### Development Tools
**IDE Configuration**:
```json
{
  "editor.formatOnSave": true,
  "typescript.tsdk": "node_modules/typescript/lib",
  "eslint.validate": ["javascript", "typescript", "typescriptreact"],
  "tailwindCSS.includeLanguages": {
    "typescript": "javascript",
    "typescriptreact": "javascript"
  },
  "vitest.enable": true,
  "prettier.requireConfig": true
}
```

### External Services
**Supabase Integration**:
- Project ID: lxjetnrmjyazegwnymkk
- Database: PostgreSQL with JSONB support
- Tables: game_states, journal_entries (with RLS policies)
- Auth: Email/password with PKCE flow, email confirmation required
- Storage: Audio and image assets with CDN
- Realtime: Event streaming with rate limiting (2 events/second)

**AI Services (Planned)**:
- OpenAI: Narrative generation (API key configured)
- Leonardo.AI: Visual generation (future integration)
- ElevenLabs: Voice synthesis (future integration)
- Suno: Music generation (future integration)

**Monitoring & Analytics**:
- Performance: Web Vitals monitoring with useWebVitals hook
- Error Tracking: Browser console monitoring + ErrorBoundary components
- Database Health: Comprehensive diagnostic functions
- User Analytics: Privacy-focused metrics (no personal data tracking)

### Key Endpoints
```yaml
Supabase API: https://lxjetnrmjyazegwnymkk.supabase.co
Local Development: http://localhost:5173 (Vite dev server)
Local Supabase: http://localhost:54321 (when running locally)
Production: [Netlify deployment URL - TBD]
Supabase Studio: http://localhost:54323 (local development)
```

---

## 🧠 Development Patterns

### Successful Patterns
- **Custom Hook Pattern**: useCombat, useCombatSounds, useImpactfulImage → Encapsulates complex state logic
- **Component Composition**: Atomic design with atoms/organisms → Flexible, reusable UI structure
- **Engine Separation**: Combat/Scene engines as separate modules → Testable, maintainable game logic
- **State Management**: Zustand for global state + React hooks for local state → Clean, performant
- **Testing Strategy**: Comprehensive unit/integration tests with Vitest → High confidence deployments
- **Mobile-First Design**: 375px viewport first, then scale up → Better mobile UX
- **Image Optimization**: WebP/AVIF with fallbacks → Performance-first approach

### Anti-Patterns to Avoid
- ❌ **Direct Supabase calls in components**: Breaks separation of concerns → Use custom hooks or store
- ❌ **Prop drilling for game state**: Makes components tightly coupled → Use Zustand store
- ❌ **Synchronous audio operations**: Blocks UI interactions → Always handle audio asynchronously
- ❌ **Manual package.json editing**: Can cause version conflicts → Use package managers (npm/yarn)
- ❌ **Ignoring build warnings**: User has psychological discomfort → Maintain zero-warning builds
- ❌ **Desktop-first design**: Primary audience is mobile → Always test mobile viewport first

---

## 📊 Performance Benchmarks

### Current Metrics (June 25, 2025)
| Metric | Current | Target | Status |
|--------|---------|---------|---------|
| Initial Load Time | 1.8s | 1.5s | 🟡 Near target |
| Combat Action Response | <100ms | <100ms | ✅ Achieved |
| Scene Transition | 200ms | 200ms | ✅ Achieved |
| Test Execution | 30s | 30s | ✅ Achieved |
| Image Loading (WebP) | <500ms | <500ms | ✅ Achieved |
| Audio Loading | Non-blocking | Non-blocking | ✅ Achieved |
| Mobile Responsiveness | 375px+ | 375px+ | ✅ Achieved |

---

## 🚀 Weekly Review Process

### Weekly Memory Updates (Every Tuesday)
- [ ] Update sprint progress and blockers
- [ ] Document new component patterns discovered
- [ ] Record performance improvements made
- [ ] Update known issues list
- [ ] Review and update CHANGELOG.md and TASK_LIST.md
- [ ] Verify test coverage and performance metrics

### Component Documentation
- [ ] Ensure new components have proper TypeScript interfaces
- [ ] Update README for significant architectural changes
- [ ] Document any new game mechanics or therapeutic features
- [ ] Review and update testing coverage (target: 80%)
- [ ] Update .agent.md with new patterns and learnings

---

## 🎮 Game-Specific Context

### Combat System Architecture (Current Implementation)
```typescript
// Core combat flow - FULLY FUNCTIONAL as of June 24, 2025
interface CombatState {
  isActive: boolean;
  playerHealth: number;
  enemyHealth: number;
  lightPoints: number;    // Combat resource (starts at 10)
  shadowPoints: number;   // Combat resource (starts at 5)
  currentAction: CombatAction | null;
  logs: CombatLog[];
  turnCount: number;      // Turn tracking with 20-turn limit
  canSurrender: boolean;  // Manual exit mechanism
}

// Key components involved - ALL TESTED AND WORKING
CombatOverlay → ActionSelector → CombatLog
     ↓              ↓            ↓
CombatEngine ← ResourceDisplay ← useCombat
     ↓              ↓            ↓
game-store ← combat-balance ← shadowManifestations
```

### Scene Management (20 Scenes - 4 Complete Cycles)
- Scene transitions handled by scene-engine.ts (20 unique scenes)
- State persistence through Supabase game_states table
- Audio integration with sound-manager.ts for immersive experience
- Progressive difficulty scaling across 4 therapeutic cycles
- Scene types: social, skill, combat, journal, exploration (5 per cycle)

### Therapeutic Integration
- Combat reflection prompts after encounters (CombatReflectionModal)
- Journal entry system with CRUD operations (JournalModal, JournalEntryCard)
- Guardian Trust progression system (0-100 scale)
- Progress tracking with milestone rewards (25, 50, 75, 100 trust levels)
- Therapeutic themes: trauma recovery, homelessness, parental loss support

---

## 🔧 Development Workflow

### Feature Implementation Flow
1. **Requirements Analysis** → Create TypeScript interfaces and plan mobile-first approach
2. **Codebase Context** → Use codebase-retrieval tool for detailed information before making changes
3. **Affects combat system?** → Test with existing combat flows (68+ tests must pass)
4. **Touches audio system?** → Ensure non-blocking implementation with sound-manager
5. **Changes game state?** → Update Zustand store and relevant custom hooks
6. **New UI component?** → Follow Shadcn/UI patterns with atomic design principles
7. **Mobile-first testing** → Test at 375px viewport first, then scale up
8. **Documentation** → Update CHANGELOG.md and TASK_LIST.md after completion

### Testing Priorities (Current: 68+ Tests Passing)
- Combat engine logic (critical path - all tests must pass)
- User authentication flows (Supabase integration)
- Scene transitions and state persistence (20-scene system)
- Audio system reliability (non-blocking loading)
- Image optimization (WebP/AVIF performance)
- Mobile responsiveness (375px+ viewports)
- Accessibility compliance (WCAG 2.1 AA)

### User Development Preferences
- **Incremental approach**: ≤50 lines of code changes per step
- **Test-driven development**: Comprehensive unit/integration tests
- **Independent verification**: User performs manual testing
- **Feature flags**: For new integrations
- **Zero warnings**: Clean builds without any warnings (psychological comfort)
- **Mobile-first**: Always test 375px viewport first
- **Documentation**: Update CHANGELOG.md and TASK_LIST.md after each step

---

## 📝 Project-Specific Notes

### Current Architecture Strengths (June 25, 2025)
- ✅ Fully functional combat system with all critical bugs resolved
- ✅ Comprehensive 20-scene therapeutic progression system
- ✅ Robust image optimization with WebP/AVIF support
- ✅ Complete audio system with 15+ track playlist
- ✅ Strong TypeScript integration with strict mode
- ✅ Effective custom hook patterns (useCombat, useCombatSounds, useImpactfulImage)
- ✅ Comprehensive test suite (68+ tests passing)
- ✅ Mobile-first responsive design approach

### Next Development Phase Focus (July 2025)
- **Supabase Journal Persistence**: Sync journal entries to database
- **AI Narrative Integration**: OpenAI-powered dynamic storytelling
- **Enhanced Mobile UX**: Further mobile optimization and testing
- **Performance Monitoring**: Automated performance tracking
- **Accessibility Enhancements**: WCAG 2.1 AA compliance improvements

### Immediate Development Priorities
1. ✅ Combat system stabilization (COMPLETED)
2. ✅ Scene engine expansion (COMPLETED)
3. ✅ Image optimization system (COMPLETED)
4. 🔄 Supabase journal persistence (HIGH PRIORITY)
5. 🔄 AI narrative generation integration (MEDIUM PRIORITY)